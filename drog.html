<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" >
	<script src="https://code.angularjs.org/1.2.16/angular.js"></script>
</head>
<body>
    <div ng-app="App">
        <div class="container" ng-controller="CrudCtrl">
            <table class="table table-bordered mt-5">
                <thead>
                    <tr>
                        <th>FloorName</th>
                        <th>Floor Number	</th>
                        <th>Total Area	</th>
                        <th>Delivery Type</th> 
                        <th>Layers</th> 
                        <th><button class="btn btn-info" ng-click="add()">Add New</button></th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="(fIndex,profile) in Profiles">
                        <td>
                            <input class="form-control" type="text" ng-model="profile.FloorName" ng-show="profile.editable" />
                            <span ng-hide="profile.editable">{{ profile.FloorName }}</span>
                        </td>
                        <td>
                            <input class="form-control" type="text" ng-model="profile.FloorNumber" ng-show="profile.editable" />
                            <span ng-hide="profile.editable">{{ profile.FloorNumber }}</span>
                        </td>
                        <td>
                            <input class="form-control" type="text" ng-model="profile.TotalArea" ng-show="profile.editable" />
                            <span ng-hide="profile.editable">{{ profile.TotalArea }}</span>
                        </td>
                        <td>
                            <input class="form-control" type="text" ng-model="profile.DeliveryType" ng-show="profile.editable" />
                            <span ng-hide="profile.editable">{{ profile.DeliveryType }}</span>
                        </td>
                        <td>
                            <table>
                                <tr>
                                <th> LayerName </th>
                                <th> Type </th>
                                <th> Size</th>
                                <th> <button class="btn btn-primary  btn-sm" ng-click="addLayer(fIndex)"> Add New </button> </th>
                                </tr>
                                <tr ng-repeat="profile in Profiles">
                                <tr ng-repeat="layer in profile.Layers">
                                    <td>
                                        <input class="form-control" type="text" ng-model="layer.LayerName" ng-show="layer.editable" />
                                        <span ng-hide="layer.editable" ng-show="layer.editable">{{ layer.LayerName }}</span>
                                    </td>
                                    <td> 
                                        <input class="form-control" type="text" ng-model="layer.Type" ng-show="layer.editable" />
                                        <span ng-hide="layer.editable" ng-show="layer.editable">{{ layer.Type }}</span>
                                    </td>
                                    <td> 
                                        <input class="form-control" type="text" ng-model="layer.Size" ng-show="layer.editable" />
                                        <span ng-hide="layer.editable" ng-show="layer.editable">{{ layer.Size }}</span>
                                    </td>
                                    <td>
                                    <div class="btn-group">
                                        <button class="btn btn-outline-info" ng-click="Subedit(fIndex, $index)" ng-hide="layer.editable">Edit</button>
                                        <button class="btn btn-outline-success" ng-click="Subsave(fIndex, $index)" ng-show="layer.editable">Save</button>
                                        <button class="btn btn-outline-danger" ng-click="Subdelete(fIndex, $index)">Delete</button>
                                    </div>
                                    </td> 
                                </tr>
                                </tr>
                            </table>
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-primary" ng-click="edit($index)" ng-hide="profile.editable">Edit</button>
                                <button class="btn btn-success" ng-click="save($index)" ng-show="profile.editable">Save</button>
                                <button class="btn btn-danger" ng-click="delete($index)">Delete</button>
                            </div>
                        </td> 
                    </tr>
                </tbody>
            </table>
            <button ng-click="viewData()">View</button>
        </div>
    </div>
    <script>
        var app = angular.module('App', []);
        app.controller('CrudCtrl', ['$scope', function($scope) {
            $scope.Profiles = [
              {
                FloorName : "Ground Floor",
                FloorNumber : "1",
                TotalArea : "2500",
                DeliveryType : "Fire Proof",
                editable : false,
                Layers: [
                  {
                    LayerName: 'PreCut Layer',
                    Type: 'Wood Layer',
                    Size: '25',
                  },
                  {
                    LayerName: 'Element Layer',
                    Type: 'Fire Layer',
                    Size: '25',
                  },
                  {
                    LayerName: 'PreCut Layer',
                    Type: 'Brecks Layer',
                    Size: '25',
                  },
                ]
              },
              {
                FloorName : "Seconda Floor",
                FloorNumber : "2",
                TotalArea : "2500",
                DeliveryType : "Fire Proof",
                editable : false,
                Layers: [
                  {
                    LayerName: 'wew Layer',
                    Type: 'Wood Layer',
                    Size: '25',
                  },
                  {
                    LayerName: 'wewes Layer',
                    Type: 'Fire Layer',
                    Size: '25',
                  },
                  {
                    LayerName: 'asd Layer',
                    Type: 'Brecks Layer',
                    Size: '25',
                  },
                ]
              }
            ];
            
            $scope.viewData = function() {
                console.log($scope.Profiles);
            }

            $scope.entity = {}
            $scope.Subentity = {}
            
            $scope.addLayer = function(index) {
              $scope.Profiles[index].editable = true;
              $scope.Profiles[index].Layers.unshift({
                editable : true,
                Layers: [
                  {
                    LayerName: '',
                    Type: '',
                    Size: '',
                  }
                
                ]
                });
            }
    
            $scope.edit = function(index){
              $scope.entity = $scope.Profiles[index];
              // $scope.entity.index = index;
              $scope.entity.editable = true;
            }
    
            $scope.Subedit = function(parentIndex, index){
              $scope.Subentity = $scope.Profiles[parentIndex].Layers[index];
              console.log($scope.Subentity);
              console.log(parentIndex);
              console.log(index);
              $scope.Subentity.editable = true;
            }
            
            $scope.delete = function(index){
              $scope.Profiles.splice(index,1);
            }   
            
            $scope.Subdelete = function(parentIndex, index){
              $scope.Profiles[parentIndex].Layers.splice(index,1);
            }     
            
            $scope.save = function(index){
              $scope.Profiles[index].editable = false;        
            }
            
            $scope.Subsave = function(parentIndex, index){
              $scope.Profiles[parentIndex].Layers[index].editable = false;
            }
        
            $scope.add = function(){
              $scope.Profiles.unshift({
                FloorName : "",
                FloorNumber : "",
                TotalArea : "",
                DeliveryType : "",
                editable : true,
                Layers: [
                  {
                    LayerName: 'XYZ',
                    Type: 'XYZ',
                    Size: 'XYZ',
                  } 
                ]
              })
              
            }
            
            $scope.Subadd = function(parentIndex, index){
              $scope.Profiles[parentIndex].Layers.push({
                editable : true,
                Layers: [
                  {
                    LayerName: '',
                    Type: '',
                    Size: '',
                  },
                  {
                    LayerName: '',
                    Type: '',
                    Size: '',
                  },
                  {
                    LayerName: '',
                    Type: '',
                    Size: '',
                  },
                ]
                
              }); 
            }
        }]);
    </script>
</body>
</html>