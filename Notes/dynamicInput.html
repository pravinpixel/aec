<!doctype html>
<html ng-app="APP">
<head>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
  <script>
        function isNumber (val) {
          return val;
        }
        function getNum(val)
        {
          return val;
        }
    var app = angular.module('APP', []);

    app.controller('MainCtrl', function ($scope, $http) {
        $scope.EngineeringEstimate = [];
        const CostEstimate = {
            'type': 'Type 1',
            'Dynamic': [
              {
                  'name' : 'CadCam',
                  "PriceM2"   : 0,
                  "Sum"       : 0, 
              },
              { 
                    'name' : 'Logistics',
                    "PriceM2"   : 0, 
                    "Sum"       : 0,

              }
            ]
        }
        $scope.EngineeringEstimate.push(CostEstimate);
        console.log($scope.EngineeringEstimate);

        $scope.add = function(){
            $scope.EngineeringEstimate[0].Dynamic.push({
                  'name' : 'test'+Math.random(),
                  "PriceM2"   : 0,
                  "Sum"       : 0, 
              },)
            
        }
        
    }).directive('customData', function(){
      return  {
        restrict: 'E',
        scope: {
          data: "=data",
        },
        template: `<input type='text' name='test' ng-model='value'>`,
        link: function(scope, element, attrs) {
            element.bind('keyup', function(){
                console.log(scope.data);
                console.log(scope.$parent);
                scope.$parent.CostEstimate.Dynamic[scope.data.currentKey].PriceM2 = scope.value * 2;
               console.log(scope.$parent.CostEstimate.Dynamic[scope.data.currentKey].PriceM2);
                scope.value
            });
        }
      }
    });
</script>
</head>
<body > 
    <div class="content-page">
        <div class="content"> 
            <!-- Start Content-->
            <div class="container-fluid"> 
                <form class="card shadow-none p-0" ng-controller="MainCtrl">
                    <div class="card-body pt-0 p-0">
                        <div class="row m-0 mt-3"> 
                            <div class="table custom-responsive p-0">  
                                <button class="btn btn-info" ng-click="add()">Add</button>
                                <table class="cost-estimate-table table table-bordered border" ng-repeat="(rootKey,CostEstimate) in EngineeringEstimate track by $index">
                                    <thead>
                                       <tr ng-repeat="(key, dynamic) in CostEstimate.Dynamic">
                                          <td> <custom-data data="{name:dynamic.name, rootKey:rootKey, currentKey: key}"> </custom-data> </td>
                                       </tr>
                                    </thead>
                                    <tbody>
                                      
                                    </tbody>
                                </table>
                            </div> 
                        </div>
                        <pre> {{ EngineeringEstimate | json }} </pre>
                    </div>
                </form> 
            </div>
        </div>
    </div>
</body>
</html>
